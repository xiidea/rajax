(function(){var fileTypeExt={image:"jpg|jpeg|gif|png|bmp|pct|psd|psp|thm|tif|ai|drw|dxf|eps|ps|svg|3dm|dwg|pln",document:"doc|pdf|docx|txt|log|msg|pages|rtf|wpd|wps|indd|qxd|qxp",data:"123|accdb|csv|dat|db|dll|mdb|pps|ppt|pptx|sdb|sdf|sql|vcf|wks|xls|xlsx|xml",archive:"zip|rar|tar|tga|7z|deb|gz|pkg|sit|sitx|zipx|cab|gzip|uue|arj",audio:"wma|mp3|amr|wav|aif|iff|m3u|m4a|mid|mpa|ra",video:"mov|mpeg|mpg|3gp|3g2|vob|flv|swf|asx|asf|rm",font:"fnt|fon|otf|ttf",script:"php|html|js|htm|htmls|dhtml|php3|phps|php4|php5|asp|aspx|htaccess|vb|asr|htpasswd|asc|as|inc|config|cs|asa"};var getScriptBase=(function(){var scripts=document.getElementsByTagName("script");var index=scripts.length-1;var myScript=scripts[index];return"/"+myScript.src.substring(0,myScript.src.lastIndexOf("/")+1).split("/").slice(3).join("/")})();function getHostname(url){var re=new RegExp("^(?:f|ht)tp(?:s)?://([^/]+)","im");var arr=url.match(re);return arr?arr[1].toString():document.location.hostname}function returnJSON(response){if(response){return eval("("+response+")")}else{return{}}}function getExtList(type){if(type==""||type=="custom"){return""}var extArr=type.split("|");var s=[];for(var i in extArr){if(fileTypeExt.hasOwnProperty(extArr[i])){s[i]=fileTypeExt[extArr[i]]}}return s.join("|")}function isIn(value,param){param=param.replace(/,/g,"|");return value.match(new RegExp(".("+param+")$","i"))}function stopDefault(e){if(e&&e.preventDefault){e.preventDefault()}else{if(window.event&&window.event.returnValue){}}window.event.returnValue=false}function addEvent(el,type,fn){if(el.addEventListener){el.addEventListener(type,fn,false)}else{if(el.attachEvent){el.attachEvent("on"+type,function(){fn.call(el)})}else{throw new Error("not supported or DOM not loaded")}}}if(document.documentElement.getBoundingClientRect){var getOffset=function(el){var box=el.getBoundingClientRect();var doc=el.ownerDocument;var body=doc.body;var docElem=doc.documentElement;var clientTop=docElem.clientTop||body.clientTop||0;var clientLeft=docElem.clientLeft||body.clientLeft||0;var zoom=1;if(body.getBoundingClientRect){var bound=body.getBoundingClientRect();zoom=(bound.right-bound.left)/body.clientWidth}if(zoom>1){clientTop=0;clientLeft=0}var top=box.top/zoom+(window.pageYOffset||docElem&&docElem.scrollTop/zoom||body.scrollTop/zoom)-clientTop;var left=box.left/zoom+(window.pageXOffset||docElem&&docElem.scrollLeft/zoom||body.scrollLeft/zoom)-clientLeft;return{top:top,left:left}}}else{var getOffset=function(el){var top=0,left=0;do{top+=el.offsetTop||0;left+=el.offsetLeft||0;el=el.offsetParent}while(el);return{left:left,top:top}}}function getBox(el){var left,right,top,bottom;var offset=getOffset(el);left=offset.left;top=offset.top;right=left+el.offsetWidth;bottom=top+el.offsetHeight;return{left:left,right:right,top:top,bottom:bottom}}function addStyles(el,styles){for(var name in styles){if(styles.hasOwnProperty(name)){el.style[name]=styles[name]}}}function copyLayout(from,to){var box=getBox(from);addStyles(to,{position:"absolute",left:box.left+"px",top:box.top+"px",width:from.offsetWidth+"px",height:from.offsetHeight+"px"})}var toElement=(function(){var div=document.createElement("div");return function(html){div.innerHTML=html;var el=div.firstChild;return div.removeChild(el)}})();var getUID=(function(){var id=0;return function(){return"RAjaxPost"+id++}})();function GetElement(el){if(el.jquery){el=el[0]}else{if(typeof el=="string"){if(/^#.*/.test(el)){el=el.slice(1)}el=document.getElementById(el)}}return el||false}function GetParentTag(el,tag,depth){var el=GetElement(el);if(!el.parentNode){return null}if(typeof tag=="undefined"){return el.parentNode}var c=depth||0;if(el.parentNode.nodeName.toLowerCase()==tag.toLowerCase()&&c==0){return el.parentNode}else{if(el.parentNode.nodeName.toLowerCase()==tag.toLowerCase()){c--;return GetParentTag(el.parentNode,tag.toLowerCase(),c)}else{return GetParentTag(el.parentNode,tag.toLowerCase(),c)}}}function fileFromPath(file){return file.replace(/.*(\/|\\)/,"")}function getExt(file){return(-1!==file.indexOf("."))?file.replace(/.*[.]/,""):""}function hasClass(el,name){var re=new RegExp("\\b"+name+"\\b");return re.test(el.className)}function addClass(el,name){if(!hasClass(el,name)){el.className+=" "+name}}function removeClass(el,name){var re=new RegExp("\\b"+name+"\\b");el.className=el.className.replace(re,"")}function removeNode(el){el.parentNode.removeChild(el)}window.SFileInput=function(name,options){this._settings={button:"",targetForm:false,deniedType:"script",allowedType:"",deniedExt:"",allowedExt:"",hoverClass:"hover",focusClass:"focus",disabledClass:"disabled",multipleFile:false,maximum:0,required:false,showFileName:true,fileNameMaxLength:33,selectedFileLabel:"",selectedFileClass:"selectedFileClass",multiInputRemoveClass:"remove",nofileMsg:"No file selected",maximumAllowedExceededMsg:"You are allowed to select {n} file(s) only",onClear:function(SFileInputObj){},onChange:function(file,extension){},onDenied:function(file,extension){},onAccept:function(file,extension){},onMaximumAllowedExceeded:function(input,maximumAllowed){return"default"},showMessage:null};for(var i in options){if(options.hasOwnProperty(i)){this._settings[i]=options[i]}}if(this._settings.multipleFile==true){this._settings.name=name+"[]"}else{this._settings.name=name}var button=GetElement(this._settings.button);if(!button||button.nodeType!==1){throw new Error("Please make sure that you're passing a valid element")}if(this._settings.deniedExt!=""&&this._settings.deniedType=="script"){this._settings.deniedType="custom"}if(this._settings.allowedExt!=""&&this._settings.allowedType==""){this._settings.allowedType="custom"}if(button.nodeName.toUpperCase()=="A"){addEvent(button,"click",stopDefault)}this.fileselected=0;this.inputCreated=0;this._button=button;this._input=null;this._disabled=false;this.enable();this._rerouteClicks()};SFileInput.prototype={disable:function(){addClass(this._button,this._settings.disabledClass);this._disabled=true;var nodeName=this._button.nodeName.toUpperCase();if(nodeName=="INPUT"||nodeName=="BUTTON"){this._button.setAttribute("disabled","disabled")}if(this._input){if(this._input.parentNode){this._input.parentNode.style.visibility="hidden"}}},enable:function(){removeClass(this._button,this._settings.disabledClass);this._button.removeAttribute("disabled");this._disabled=false},reset:function(){this._clearInput()},_showMessage:function(msg){var self=this;if(self._settings.showMessage){self._settings.showMessage.call(self,msg)}else{alert(msg)}},_createLabel:function(){var self=this;var label=document.createElement("label");label.setAttribute("id","sfinput-label-id-for-"+self._input.name);self._button.parentNode.insertBefore(label,self._button.nextSibling);return label},_createMultipleLabel:function(){var self=this,ol;if(self._label.childNodes.length>0){ol=self._label.childNodes.item(0)}else{ol=document.createElement("ol");self._label.appendChild(ol)}var li=document.createElement("li");li.setAttribute("id","sf-input-label-mid-for-"+self.inputCreated+self._input.name);ol.appendChild(li);return li},_createInput:function(){var self=this;var input=document.createElement("input");input.setAttribute("type","file");input.setAttribute("name",this._settings.name);addStyles(input,{position:"absolute",right:0,margin:0,padding:0,fontSize:"480px",fontFamily:"sans-serif",cursor:"pointer"});var div=document.createElement("div");addStyles(div,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483583});if(div.style.opacity!=="0"){if(typeof(div.filters)=="undefined"){throw new Error("Opacity not supported by the browser")}div.style.filter="alpha(opacity=0)"}addEvent(input,"change",function(){if(!input||input.value===""){return}var selected=input.files.length||1;var file=fileFromPath(input.value);var ext=getExt(file);if(self._settings.maximum>0&&(self.fileselected+selected)>self._settings.maximum){if("default"===self._settings.onMaximumAllowedExceeded.call(self,self,self._settings.maximum)){self._showMessage(self._settings.maximumAllowedExceededMsg.replace("{n}",self._settings.maximum.toString()))}return}var deniedExt=(self._settings.deniedType=="custom")?self._settings.deniedExt:getExtList(self._settings.deniedType);var allowedExt=(self._settings.allowedType=="custom")?self._settings.allowedExt:getExtList(self._settings.allowedType);var isValid=self._validateType(file,deniedExt,allowedExt);if(isValid!==true){if(true!==self._settings.onDenied.call(self,file,ext)){var alert_str="";if(isValid==="denied"){alert_str="*."+ext+" file is not allowed"}else{if(self._settings.allowedType=="custom"){alert_str="only (*."+allowedExt.split("|").join(", *.")+") extension(s) are allowed"}else{alert_str="only "+self._settings.allowedType.split("|").join(",").replace(/,([^,]+)$/," & $1")+" file(s) are allowed"}}self._showMessage(alert_str)}return}if(false===self._settings.onAccept.call(self,file,ext)){return}if(false===self._settings.onChange.call(self,file,ext)){return}if(!self._label){var label=GetElement(self._settings.selectedFileLabel);if(!label){label=self._createLabel()}if(self._settings.selectedFileClass!=""){addClass(label,self._settings.selectedFileClass)}else{addStyles(label,{marginLeft:"10px"})}self._label=label}if(!self._settings.showFileName){addStyles(self._label,{display:"none"})}var inputMoveTo;removeClass(self._button,self._settings.hoverClass);if(self._settings.multipleFile==true){var multiInput=self._createMultipleLabel();multiInput.innerHTML=self._formatFileName(file);inputMoveTo=multiInput}else{self._label.innerHTML=self._formatFileName(file);inputMoveTo=self._label}if(!self._parentForm){var dummyDiv=GetElement("dummy-"+inputMoveTo.id);if(dummyDiv){removeNode(dummyDiv)}self._moveInput(self._form,inputMoveTo)}else{self._moveInput(inputMoveTo,inputMoveTo)}});addEvent(input,"mouseover",function(){addClass(self._button,self._settings.hoverClass)});addEvent(input,"mouseout",function(){removeClass(self._button,self._settings.hoverClass);removeClass(self._button,self._settings.focusClass);if(input.parentNode){input.parentNode.style.visibility="hidden"}});addEvent(input,"focus",function(){addClass(self._button,self._settings.focusClass)});addEvent(input,"blur",function(){removeClass(self._button,self._settings.focusClass)});div.appendChild(input);this._parentForm=GetParentTag(this._button,"form");var form=self._settings.targetForm||this._parentForm;if(!form){throw new Error("The input is without a form element")}addEvent(form,"reset",function(){self._clearInput()});this._form=form;document.body.appendChild(div);this._input=input},_moveInput:function(el,wrapper_el){var el=GetElement(el);var self=this;if(self._input){self._input.onChange="";self._input.parentNode.onMouseover="";addStyles(self._input.parentNode,{visibility:"hidden",width:"0px",height:"0px",left:0,top:0});var tempinput=self._input.parentNode;tempinput.setAttribute("id","dummy-"+wrapper_el.id);removeNode(self._input.parentNode);if(self._settings.multipleFile){self._createRemoveButton(wrapper_el,tempinput)}el.appendChild(tempinput);self.fileselected++;self.inputCreated++;self._input=null;self._createInput()}else{throw new Error("something gone wrong!!")}},_createRemoveButton:function(el,temp){var self=this;var remove=document.createElement("a");addClass(remove,self._settings.multiInputRemoveClass);remove.innerHTML="<span>x</span>";addEvent(remove,"click",function(){self.fileselected=self.fileselected-1;removeNode(temp);removeNode(this.parentNode)});el.appendChild(remove)},_clearInput:function(){var self=this;if(!self._input){return}self._input.fileselected=0;self._input.inputCreated=0;self._settings.onClear.call(self,self);if(self._label){self._label.innerHTML="";var dummyContainer=GetElement("dummy-"+this._label.id);dummyContainer&&removeNode(dummyContainer)}removeNode(this._input.parentNode);this._input=null;this._createInput();removeClass(this._button,this._settings.hoverClass);removeClass(this._button,this._settings.focusClass)},validate:function(){var self=this;if(!self._validate()){self._showMessage(self._settings.nofileMsg);return false}return true},_validate:function(){var self=this;if(self._settings.required){return(self.fileselected&&self.fileselected>0)}return true},_validateType:function(file,deniedExt,allowedExt){if(deniedExt!=""){if(isIn(file,deniedExt)){return"denied"}}else{if(allowedExt==""){return true}}if(allowedExt!=""){return(false||isIn(file,allowedExt))&&true}return true},_rerouteClicks:function(){var self=this;addEvent(self._button,"mouseover",function(){if(self._disabled){return}if(!self._input){self._createInput()}var div=self._input.parentNode;copyLayout(self._button,div);div.style.visibility="visible"})},_formatFileName:function(name){var trimOption=this._getTrimmingOptions(name);if(trimOption){name=name.slice(0,trimOption.first)+"..."+name.slice(-1*trimOption.last)}return name},_getTrimmingOptions:function(name){if(this._settings.fileNameMaxLength>=name.length){return false}var ext=getExt(name);if(ext.length*2>=this._settings.fileNameMaxLength-4){return false}var trimOption={};trimOption.last=(ext.length*2)+1;trimOption.first=this._settings.fileNameMaxLength-trimOption.last-3;return trimOption}};window.Rajax=window.rajax=function(form,options){this._settings={debug:false,localResource:getScriptBase+"blank.html",action:null,data:{},responseType:false,noCache:true,finputs:{},autoSubmit:false,onSubmit:function(){},onBeforeSubmit:function(){},onAfterSubmit:function(){},onComplete:function(response){}};for(var i in options){if(options.hasOwnProperty(i)){this._settings[i]=options[i]}}this.xdm_formSubmitted=false;this.sameDomainRestored=false;if(form!=""){var form=GetElement(form);if(!form||form.nodeType!==1){throw new Error("Please make sure that you're passing a valid element")}if(form.nodeName.toUpperCase()!="FORM"){throw new Error("Please make sure that you're passing a valid form element")}}else{form=this._createForm();form.generated=true}this.sfinputs=new Array();for(var i in this._settings.finputs){if(form.generated){this._settings.finputs[i]["targetForm"]=form}this.sfinputs[i]=new SFileInput(i,this._settings.finputs[i])}this._form=form;if(this._settings.action==null){this._settings.action}if(this._settings.autoSubmit&&form!=""){self=this;addEvent(self._form,"submit",function(){self.post()})}};rajax.prototype={setData:function(data){this._settings.data=data},_createIframe:function(){var id=getUID();var iframe=toElement('<iframe src="javascript:false;" name="'+id+'" />');iframe.setAttribute("id",id);iframe.style.display="none";if(!this._settings.debug){document.body.appendChild(iframe)}return iframe},_createForm:function(){var form=toElement('<form method="post" enctype="multipart/form-data"></form>');form.style.display="none";document.body.appendChild(form);return form},_configForm:function(iframe,form){var settings=this._settings;form.setAttribute("action",settings.action);if(settings.debug){form.setAttribute("target","_blank")}else{form.setAttribute("target",iframe.name)}form.method="POST";form.setAttribute("enctype","multipart/form-data");form.setAttribute("encoding","multipart/form-data");if(document.getElementById("rajax_input_holder"+iframe.name)){var div=document.getElementById("rajax_input_holder"+iframe.name);div.innerHTML=""}else{var div=document.createElement("div");addStyles(div,{display:"none",position:"absolute"});div.setAttribute("id","rajax_input_holder"+iframe.name);form.appendChild(div)}for(var prop in settings.data){if(settings.data.hasOwnProperty(prop)){var el=document.createElement("input");el.setAttribute("type","hidden");el.setAttribute("name",prop);el.setAttribute("value",settings.data[prop]);div.appendChild(el)}}return form},clear:function(){this._form.reset()},_getResponse:function(iframe){var toDeleteFlag=false,self=this;addEvent(iframe,"load",function(){var settings=self._settings;if(iframe.src=="javascript:'%3Chtml%3E%3C/html%3E';"||iframe.src=="javascript:'<html></html>';"){if(toDeleteFlag){setTimeout(function(){removeNode(iframe)},0)}return}var response;if(self.xdm_formSubmitted&&!self.sameDomainRestored){self.sameDomainRestored=true;iframe.contentWindow.location=settings.localResource;return false}else{if(self.xdm_formSubmitted&&self.sameDomainRestored){response=iframe.contentWindow.name;self.sameDomainRestored=false;self.xdm_formSubmitted=false;if(!response){response=""}if(settings.responseType&&settings.responseType.toLowerCase()=="json"){response=returnJSON(response)}settings.onComplete.call(self,response,self);toDeleteFlag=true;iframe.src="javascript:'<html></html>';";return}}var doc=iframe.contentDocument?iframe.contentDocument:window.frames[iframe.id].document;if(doc.readyState&&doc.readyState!="complete"){return}if(doc.body&&doc.body.innerHTML=="false"){return}if(doc.XMLDocument){response=doc.XMLDocument}else{if(doc.body){response=doc.body.innerHTML;if(settings.responseType&&settings.responseType.toLowerCase()=="json"){if(doc.body.firstChild&&doc.body.firstChild.nodeName.toUpperCase()=="PRE"){doc.normalize();response=doc.body.firstChild.firstChild.nodeValue}response=returnJSON(response)}}else{response=doc}}settings.onComplete.call(self,response,self);toDeleteFlag=true;iframe.src="javascript:'<html></html>';"})},post:function(){var self=this,settings=this._settings;if(!this._form){return false}var iframe=this._createIframe();if(false===settings.onBeforeSubmit.call(this,this)){return false}var form=this._configForm(iframe,this._form);for(var i in this.sfinputs){if(!this.sfinputs[i]._validate()){this.sfinputs[i]._showMessage(this.sfinputs[i]._settings.nofileMsg);return false}}if(false===settings.onSubmit.call(this,this,this._form)){return false}if(settings.noCache){form.action+=(form.action.indexOf("?")!=-1)?"&"+new Date().getTime():"?"+new Date().getTime()}if(getHostname(settings.action)!=document.location.hostname.toString()){this.xdm_formSubmitted=true}form.submit();settings.onAfterSubmit.call(this,this,form);removeNode(document.getElementById("rajax_input_holder"+iframe.name));if(settings.debug){iframe=null;return}this._getResponse(iframe);return false}}})();